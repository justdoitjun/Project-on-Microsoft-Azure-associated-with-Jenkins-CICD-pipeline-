pipeline{
    agent any
    environment{
                // Azure Blob Storage 계정 정보 설정
                resourceGroupName="finalservice5"
                storageAccountName="justdoitjunblob"
               accountKey="5v2XfQvfqruNpiQmdfoZbLJUMLtiyZ/CB2RZsN+T5jn8PTQbN/BatHH9JdIgFdkb12NH0MsG0OOR+ASti7AbXA=="
                containerName="codedeploy"
                localFilePath="/bitnami/jenkins/home/workspace/justdoitjun/target/finalService-0.0.1-SNAPSHOT.war"
		localFilePath2="/bitnami/jenkins/home/workspace/justdoitjun/target/finalservice5.zip"
                blobName="finalservice5"
                blobName2="finalservice5.zip"

		groupName="finalservice5"
		appName="justdoitjun"
		blobPath="https://justdoitjunblob.blob.core.windows.net/codedeploy/finalservice5"
    }
    tools {
			maven('maven396')
    }
    stages {
        stage('mvn build'){
            steps{
                echo 'mvn clean package'
                sh 'chmod +x mvnw'
		sh 'mvn clean package'
            }
        }
        stage('code upload'){
		        steps{
			        echo 'code upload'
sh 'zip finalservice5.zip ./*'
sh 'az storage blob upload --overwrite --account-name "$storageAccountName" --account-key "$accountKey" --container-name "$containerName" --file "$localFilePath" --name "$blobName2" '

//로컬 파일을 Blob Storage에 업로드
//sh 'az storage blob upload --overwrite --account-name "$storageAccountName" --account-key "$accountKey" --container-name "$containerName" --file "$localFilePath" --name "$blobName" '
	}
        }
	stage('code deploy'){
		steps{
		echo 'code deploy'
		sh 'az login'
		sh 'az account set --subscription "Azure for Students"'
		sh 'az webapp deploy --resource-group "$groupName" --name "$appName" --src-url "$blobPath" --type zip'
		//sh 'az webapp deploy --resource-group "$groupName" --name "$appName" --src-url "$blobPath"'

		//sh 'az webapp deploy --resource-group "$groupName" --name "$appName" --src-path ./<package-name>.war'
		}
	}
    }
}
