pipeline{
    agent any
    environment{
                // Azure Blob Storage 계정 정보 설정
                resourceGroupName="finalservice5"
                storageAccountName="justdoitjunblob"
               accountKey="5v2XfQvfqruNpiQmdfoZbLJUMLtiyZ/CB2RZsN+T5jn8PTQbN/BatHH9JdIgFdkb12NH0MsG0OOR+ASti7AbXA=="
                containerName="codedeploy"
                localFilePath="/bitnami/jenkins/home/workspace/justdoitjun/target/finalService-0.0.1-SNAPSHOT.war"
                blobName="finalservice5"

								groupName="finalService5"
								appName="justdoitjun"
								tomcatPath="target"
    }
    tools {
			maven('maven396')
    }
    stages {
        stage('mvn build'){
            steps{
                echo 'mvn clean package'
                sh 'chmod +x mvnw'
		sh 'mvn clean package'
            }
        }
        stage('code upload'){
		        steps{
			        echo 'code upload'
//로컬 파일을 Blob Storage에 업로드
sh 'az storage blob upload  --account-name "$storageAccountName" --account-key "$accountKey" --container-name "$containerName" --file "$localFilePath" --name "$blobName" '
	}
        }
	stage('code deploy'){
		sh 'az webapp deploy --resource-group "$groupName" --name "$appName" --src-path ./<package-name>.war'
	}
    }
}
